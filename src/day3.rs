enum Tile {
    Tree,
    Clear,
}

fn parse_tiles(row: &str) -> Vec<Tile> {
    row.chars()
        .map(|x| if x == '#' { Tile::Tree } else { Tile::Clear })
        .collect()
}

fn find_collisions(map: &Vec<Vec<Tile>>, x_slope: usize, y_slope: usize) -> usize {
    let mut x_pos = 0;
    let mut y_pos = 0;
    let mut trees_encountered = 0;
    while y_pos < map.len() {
        let row = &map[y_pos];
        match row[x_pos % row.len()] {
            Tile::Tree => trees_encountered += 1,
            Tile::Clear => {}
        };
        x_pos += x_slope;
        y_pos += y_slope;
    }
    trees_encountered
}

fn puzzle1(input: Vec<&str>) -> usize {
    let map = input.iter().map(|&x| parse_tiles(x)).collect();
    find_collisions(&map, 3, 1)
}

fn puzzle2(input: Vec<&str>) -> usize {
    let map = input.iter().map(|&x| parse_tiles(x)).collect();
    find_collisions(&map, 1, 1)
        * find_collisions(&map, 3, 1)
        * find_collisions(&map, 5, 1)
        * find_collisions(&map, 7, 1)
        * find_collisions(&map, 1, 2)
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn first_puzzle_test_input() {
        assert_eq!(puzzle1(TEST_INPUT.to_vec()), 7);
    }

    #[test]
    fn first_puzzle_real_input() {
        assert_eq!(puzzle1(REAL_INPUT.to_vec()), 195);
    }

    #[test]
    fn second_puzzle_test_input() {
        assert_eq!(puzzle2(TEST_INPUT.to_vec()), 336);
    }

    #[test]
    fn second_puzzle_real_input() {
        assert_eq!(puzzle2(REAL_INPUT.to_vec()), 3772314000);
    }

    const TEST_INPUT: &'static [&'static str] = &[
        "..##.......",
        "#...#...#..",
        ".#....#..#.",
        "..#.#...#.#",
        ".#...##..#.",
        "..#.##.....",
        ".#.#.#....#",
        ".#........#",
        "#.##...#...",
        "#...##....#",
        ".#..#...#.#",
    ];
    const REAL_INPUT: &'static [&'static str] = &[
        ".#..#....##...#....#.....#.#...",
        "........##....#..#..##....#.#..",
        "......##......##.........#....#",
        "...#.....#....##.......#.#....#",
        ".#.###.#.#..#.....##..#....#.#.",
        "##.........##.....####......#..",
        "#...#..........#.##............",
        "####............#..........#.#.",
        "......#......#....##...#..##...",
        "#..#....#...#......#......####.",
        "......#..........#.........#.#.",
        "...##.......#..#.#..#..#....#..",
        "..####....#.#...............##.",
        "...###........#.....#..........",
        "#..#.##...##.#..##...##...#....",
        ".###........#.##..#.#.....#....",
        ".#.......#..##.......#......#..",
        ".##...........#..............#.",
        "...#..#.....#...........#...#..",
        ".....#..............#..#.......",
        ".......#....#.....##...........",
        ".#...#.............#.....##....",
        "....#.#....#...#...#..#..##.#..",
        "...#..##..##...#..##........#.#",
        ".###..#...#.#.#.#..#...#.......",
        ".....##.#.##.#.#.......#..#....",
        ".##.#...#.....#...#....#.....#.",
        ".....#......###....###..##.#..#",
        ".....#..##....#..#.#..#.#.#....",
        "#....#.....#.#.......#...#....#",
        "...#........#............#..#..",
        "#.#...#...#..##.........#...##.",
        ".#..#.#...........#....#...#...",
        "##..#.#..........#.....###...#.",
        "#..#........#.......#.#..#....#",
        "..#...##....#..#....#....#.....",
        "...#.....##....#...#..#....##.#",
        ".....#......#...#.#.#.#.#......",
        "###.....#..#.#..........##.#...",
        "...............#..#...#.#....#.",
        "#.....#.....###....#..........#",
        "........#...#.#.......#..#...#.",
        "..#.##...#...#...#.........#...",
        "#..........#..#.#...........##.",
        "##.......#.#.#...#.....#.......",
        "...#.#.#.....#......#....##..#.",
        "##.#.....#....#...#.......#....",
        ".#......##..#.##.#....##..##.#.",
        "..#..#......#....#...#..#.#....",
        "...#..###...#.......#..#.......",
        "...#....#..#....#........##....",
        "#...#...#....#.#.........###.#.",
        ".#.........##..##...#..........",
        "...##.....##.........#..#..#...",
        "###....#......#.##..#...#......",
        ".###....#.#.......#..#....#...#",
        "....####........##....#.#....##",
        "..#.....#......##...#..#..#....",
        "...#....#...#......#.###.#.#.#.",
        "......#.......#..#...#...#.....",
        ".#...#...#..#.#..........#.....",
        "........#..#.........#.#....##.",
        ".#....#.......#........#.##.#..",
        "...#...#..#.....#......#...##..",
        ".#.................#........###",
        ".......#.#..#.#...#............",
        ".#.......#..##...#.###....#.##.",
        "#........#.###.#..#........##..",
        "..##.#....##......##........#..",
        "...............#...............",
        "#.......#......##..#.#....#.#.#",
        "..#.....#......#.#.#...#...##..",
        "..........#........#.....##...#",
        "#..........#.#..#..##..#......#",
        ".......#..###..##.#..##........",
        "#.#..##..###..#.###.....#.#..##",
        "..#.#........#...###...##......",
        ".......##.....##...#.##........",
        ".#.#...###..#..#......##....##.",
        "#...#.#.....##..#..#..#.#....#.",
        "........#......#....#..#.......",
        "...#.#.#.#........###....#...#.",
        ".#......#...#.......#......#...",
        "#...#.##.#..#.#..#.........#...",
        "....#......##......#........#.#",
        "..##.#.....#..#......#..#......",
        "#.##...##...#................#.",
        ".....#..#....#....#####........",
        "....#..#..#.#...#.#............",
        ".........#.#....#..#....##...#.",
        "#....#..........#......#......#",
        ".......#..............#......#.",
        ".#..#...#..#.#.....#.#.#.##.#..",
        ".##........#......#...#.##.....",
        "...#.##..#........#...........#",
        "..#...#..#........#.......#.#..",
        "#.....#..#.#..#..#...#...#..#..",
        "..................#.#.....#...#",
        "........#...##.#..#.........#..",
        ".#...##.#...........##.##...#..",
        "#......#.........#...#...#...#.",
        "..........#.............#...#..",
        "#............##.#..#...#.#...#.",
        "..#.##...##....##.#...####...#.",
        "#.##..#......#.......#.#...##..",
        ".....#...#..#......#####.##..#.",
        "#...#.#.##..#..##.....#......#.",
        ".#..#......#.#.#...#.#...##.#..",
        ".#.....#..##........#.....#...#",
        ".................#..........#..",
        "##.#.#......#.####..#.....#....",
        ".#...##.####..#...#............",
        "..#...............###....#....#",
        "#...#..###..#.#.##...........##",
        "...................#..#.....#..",
        "...#.##.#...#.....#......#.##..",
        "#.#...#.........##.#........#.#",
        ".##.......#..#..#.....##....#..",
        "......##.#.#..#...#.#..##.....#",
        "..#..###...#...#......#.#......",
        "..##....#.#...#....#....#..#..#",
        "#..##....#........#..##..#..#.#",
        ".......#............#....##..#.",
        ".#.#..#.........#.#.##......#..",
        "#.#....#..##..#..###.#.....##..",
        ".###.#......#.....#####...#....",
        "#...#.#...##......#...#.#...##.",
        "#..#.........#..#............#.",
        "...##......##.......##....##...",
        "...#...##....###..###.#...#....",
        "#.#....#...#.#...##..#........#",
        ".#..#..................#....#..",
        "#......#..#...##..##...#..##..#",
        "...#..#.....#...#........#.#.#.",
        "#...#..##....#.....#........#..",
        ".##..#....#.....#.#............",
        "##..##.#.#.##.#.#..#.#..#....#.",
        "#.......#...............#.....#",
        "..#.....#..##.....#...##.##....",
        "...#..#...#.#.#....#......#....",
        "###.#.......#....#....#.#...#..",
        ".....###..#...###.#.#..#.......",
        ".....#.........##.#....#..##.#.",
        "........#....#....#....#.#..##.",
        "........###....#.#.........#.#.",
        ".#..###..#........#.......##.#.",
        ".#.#...........................",
        "..#....##...#.#....#....#.#....",
        ".#...#...##.#........###....#..",
        "#.#....#...#.#.#...##......##..",
        "#......#....#...#..#....#...#..",
        "...#..##........#.#...##......#",
        "....##...........##...#..#..#..",
        "......#..#........#..#....##.##",
        ".###..#.#.........#.....#......",
        ".#..##............#......#.....",
        "..##.#.#..#..#.###....#..#..#..",
        "....#.#..#.#..##...##.#.#.#.#..",
        "....#..#....#...............#..",
        "..#...#.##.....##....#..##..#..",
        ".......##.#....#.##....#.......",
        ".#...#........#...#......#.###.",
        "..#....##.......#....#.#...#.#.",
        ".....#.....#...##..#....#.#..##",
        "..##........##............##...",
        "..........#...#.......#.......#",
        ".#...............#...#.##......",
        "#.##......#....#.##.#..#..#...#",
        "......###.........#...#..#....#",
        "....#......#...#....#....#...#.",
        "#...##...#....#......####....#.",
        ".................#......#......",
        "..#..........##.......##..#.##.",
        ".#.....#.......#...######..#..#",
        "....##.#...#...#..........#....",
        ".....#.......#...#.#.......###.",
        "#...#.###.....#...#.......#....",
        ".#.##.####....#.....#.#........",
        ".......#.....##............##..",
        "..#...#.#.##........#...##...#.",
        "........#...####.##..#....#...#",
        "#.......#...##.#......#..#...#.",
        "......#.........#..###.#.#....#",
        "#..##...#...#..#...#...#.....#.",
        ".#...#...#.#.................##",
        "#......#.....#..#.#..#......##.",
        ".......#.##...#.......#.......#",
        ".#.#..#..#......#....#.#...#.#.",
        "..#...#.#..#......#...#.#.#....",
        "........#..............#..##...",
        ".##..#..##.#....#.#..###..#..#.",
        "..#....#......#...#.#.#....#...",
        "...#..#..#....#..#.....##......",
        ".#......#...#........##........",
        ".#......#..#...##..#..#.#.#....",
        ".##......#.##.........#....#...",
        "....#....##..#..###.#..#......#",
        "....#....##..........#.#...#...",
        "..##.#.............#..#.....#..",
        "..#.....#....#....#.......##...",
        ".##.#....#....#...#....##.#....",
        "...#.#..#.###.#..#.#.......#.#.",
        ".....##.....#.......#......#...",
        ".#.....#..#.#.#..#........##...",
        "##.....................#.......",
        "..###............#........##..#",
        ".#.##.....#..#..#..#.#.......#.",
        ".##...................#..#..#..",
        "..#.#...#..........##..#..##...",
        "#......#..#..#.#..#......#..#.#",
        ".#...#....#.#.........#.....#.#",
        "#..........#.#....#....#.#.#.#.",
        "#.....#..........#..#....#..#..",
        "........#....#..##.#.#.......#.",
        ".#.......##.......#..##...#....",
        "...#..##..#......##.#..#.#..#..",
        ".#..#.......#..##..#......#....",
        "###.#.........#......#.#.......",
        "...#......#....#..##..#.#..#...",
        "......#..#.....#.........#....#",
        "....#..#..#..#.........##.#..#.",
        "......#..#..#..#....#...#..##.#",
        "......##.#..#..#.#.......#.#.##",
        "..#.....#...#..#....#..........",
        ".##..##.....##.......#.##.#....",
        "...#..#.......#..#.......#.....",
        ".........#....##..#.#....#.#...",
        ".....#..#...#.........#....#..#",
        ".........##.....#.#...#.###...#",
        ".#......####..##...#..#........",
        ".#......##....#.....#..........",
        "##.......##.#.......#..........",
        ".#......#.#.#.#....#........#..",
        "......##..##...#...#...........",
        ".#...#.#..#......#.#.#.#....#.#",
        "...#.........#.....#...###.....",
        "#.....##....#.##...#....#......",
        ".#..#...#..##.###.#.#.#...#....",
        "...#......#..#....#...#...#....",
        ".#..............#.....#........",
        "..##...#.....#..#.....#..#.#...",
        ".##...#....#.##...#.........##.",
        "..#......#...##..#.....#......#",
        "#.#..............#...#...#..#.#",
        "..#..#.#...........#...#.#.#...",
        "#..........#...#..#..##..#....#",
        "............#...#........###...",
        ".........#.....#.....#..#......",
        "#...#.#..##......#.#####.......",
        "...#........#..............#...",
        "......###.#.#.....#..#....##.#.",
        ".#.#.#..##....###.#..#....##...",
        ".#....#.##............##.#.....",
        "##...##.#......#.#.##.##...###.",
        ".......#.#........#.....#......",
        "....#.....#......#...#.#..#....",
        ".#.........#....#...#...#...#.#",
        "#.......#................#..#..",
        ".##...........#.##...##....#...",
        "#...#.#...###.........#.......#",
        ".#...#.........................",
        "#.......#...#.....##.##...##...",
        ".#.#....#.......#.#.##.#....#..",
        "#..#....#...#.#.##.#....#....#.",
        ".##.....#.#..#...#..#..........",
        ".............#...#.#..#........",
        "....#........#..#......##......",
        "#.....#....#.....#.......#.....",
        "........#.......##....#........",
        ".#.#..##.......................",
        "##..#.....#........#.....#.....",
        ".#......#.#...#.#..........#..#",
        ".#..#.....#..#..........#.###..",
        "......#.#..#.#.......#.#.....#.",
        ".#....#......#..##.............",
        "#...##.........#.#.#...#.....#.",
        "..#................#..#..###...",
        "#.....#....##.#..##......#.#.#.",
        "..#....#...#...#...............",
        "#................#....#...#.#..",
        "................#...#.....#.##.",
        "..#.#.#..#.##.......##.......##",
        "...........#......##.......###.",
        "...#.......##.........#.#.#.#..",
        ".#...#.#..#...#.#.....#........",
        "............#####......##......",
        "....###....#.##...#..#.........",
        "..#.#...#.......#...#...#.###..",
        "..............##..#...#....#...",
        "#.#..##...#....##.........#....",
        "..#...#.....#...........#...#..",
        "#.#..###..#.#..#........#..#.#.",
        "...###...##...#...#.#.........#",
        "..#........#.....#.#.#.......#.",
        "...#..#..........#.....#...#...",
        "....#..#.....#....##....#.##...",
        ".....##..#...#.#..##...#...##.#",
        "...........###...##....#.......",
        "##..#.#..#..#...#....##..#..#..",
        "##...#.#......##.#..#...#....#.",
        ".#.......#...........#...#.....",
        "#...#....#.......#...#.##......",
        ".........#.......#...#.#...#...",
        ".......##.#..................#.",
        "........#..#.#......#.....#....",
        ".....#.#.#.#....##...#.###.....",
        "#.#.........#..#.#.#.#.#.......",
        ".............#....#.......###..",
        ".#.##....#....##.........####..",
        "...........###.#...............",
        "#.........##.#.#..#.....##.###.",
        ".#.#.....#.#...#.....##...#...#",
        "#....#...#.........#.#.......#.",
        ".....#.###..#....#...##..#...#.",
        "#........#....#.#..#....#.#....",
        "#.#..##......#.........#.#.....",
        "##..#.....#......###....#....#.",
        "#.#.####..#.#.#......##...#..#.",
        "....#.....#.#.#.#.....#........",
        "..##..........#......#.#.#..#..",
        ".#...##.##.........#.........##",
        "..#.#.#..........#..#..#......#",
        "###..###..#...#................",
    ];
}
